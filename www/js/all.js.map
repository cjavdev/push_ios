{"version":3,"sources":["app.js","config.js","Model.js","User.js","LoginCtrl.js","AccountCtrl.js","Friend.js","FriendRequest.js","FriendsCtrl.js","FriendRequestsCtrl.js","Workout.js","WorkoutSet.js","WorkoutCtrl.js","WorkoutsCtrl.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["/*global angular, openFB, window, cordova */\n\nvar dependencies = ['ionic', 'push.controllers', 'push.services'];\n\nwindow.PB = angular.module('push', dependencies)\n  .run(function ($ionicPlatform) {\n    openFB.init({ appId: '1389364367952791' });\n\n    $ionicPlatform.ready(function () {\n      // Hide the accessory bar by default (remove this to show the\n      // accessory bar above the keyboard for form inputs)\n      if (window.cordova && window.cordova.plugins.Keyboard) {\n        cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);\n      }\n\n      if (window.StatusBar) {\n        // org.apache.cordova.statusbar required\n        StatusBar.styleDefault();\n      }\n    });\n  })\n  .constant('loc', {\n    // apiBase: 'http://localhost:3000'\n    apiBase: 'http://www.pushbit.io'\n  });\n\n","/*globals PB, angular */\n\nangular.module('push.controllers', []);\nangular.module('push.services', []);\n\nPB.config(function ($stateProvider, $urlRouterProvider, $httpProvider) {\n    $httpProvider.interceptors.push(function($q, $rootScope) {\n      return {\n        'responseError': function(rejection) {\n          console.log('RESPONSE ERROR', rejection);\n           if(rejection.status === 403) {\n             $rootScope.$broadcast('event:auth-loginRequired', rejection);\n           }\n           return $q.reject(rejection);\n        }\n      };\n    });\n\n    $stateProvider\n      .state('tab', {\n        url: \"/tab\",\n        abstract: true,\n        templateUrl: \"templates/tabs.html\"\n      })\n      .state('tab.workouts', {\n        url: '/workouts',\n        views: {\n          'tab-workouts': {\n            templateUrl: 'templates/tab-workouts.html',\n            controller: 'WorkoutsCtrl'\n          }\n        }\n      })\n      .state('tab.friends', {\n        url: '/friends',\n        views: {\n          'tab-friends': {\n            templateUrl: 'templates/tab-friends.html',\n            controller: 'FriendsCtrl'\n          }\n        }\n      })\n      .state('tab.account', {\n        url: '/account',\n        views: {\n          'tab-account': {\n            templateUrl: 'templates/tab-account.html',\n            controller: 'AccountCtrl'\n          }\n        }\n      });\n\n    $urlRouterProvider.otherwise('/tab/workouts');\n  });\n","/*global _, angular */\nangular.module('push.services')\n  .factory('Model', function ($http, $q, loc) {\n    return function (options) {\n      var url = loc.apiBase + options.path;\n\n      class Model {\n        constructor(attrs) {\n          attrs = attrs || {};\n          this.attributes = {};\n          this.set(attrs);\n        }\n\n        set(attrs) {\n          for(var attr in attrs) {\n            this.attributes[attr] = attrs[attr];\n          }\n          return this;\n        }\n\n        get(key) {\n          return this.attributes[key];\n        }\n\n        parse(response) {\n          return response;\n        }\n\n        save() {\n          if(this.id) {\n            return this.update();\n          } else {\n            return this.create();\n          }\n        }\n\n        update() {\n          var dfd = $q.defer();\n          $http\n            .put(this.url(), this.attributes)\n            .then((response) => {\n              this.set(this.parse(response.data));\n              dfd.resolve(this);\n            }, (response) => {\n              dfd.reject(this);\n            });\n          return dfd.promise;\n        }\n\n        create() {\n          var dfd = $q.defer();\n          $http\n            .post(this.url(), this.attributes)\n            .then((response) => {\n              this.set(this.parse(response.data));\n              dfd.resolve(this);\n            }, (response) => {\n              dfd.reject(this);\n            });\n          return dfd.promise;\n        }\n\n        url() {\n          if(this.id) {\n            return url + this.id;\n          } else {\n            return url;\n          }\n        }\n      }\n\n      Model.url = () => { return url; };\n\n      Model.all = function () {\n        return $http.get(url).then((response) => {\n          return _.map(response.data, (data) => {\n            return new Model(data);\n          });\n        });\n      };\n\n      Model.create = function (attributes) {\n        var model = new Model(attributes);\n        return model.save();\n      };\n      return Model;\n    };\n  });\n","/*global angular,openFB */\nangular.module('push.services')\n  .factory('User', function ($q, $http, $window, $rootScope, loc) {\n    function fbLogin() {\n      var dfd = $q.defer();\n      openFB.login(function (response) {\n        if (response.status === \"connected\") {\n          getFBAuthParams(response.authResponse).\n            then(function (user) {\n              dfd.resolve(user);\n            });\n        } else {\n          dfd.reject(response.status);\n        }\n      }, {\n        scope: 'email,user_friends,public_profile'\n      });\n      return dfd.promise;\n    }\n\n    function getFBAuthParams(authResponse) {\n      var dfd = $q.defer();\n      openFB.api({\n        path: '/v1.0/me',\n        success: function (response) {\n          response.authResponse = authResponse;\n          pushbitLogin(response).\n            then(function (user) {\n              dfd.resolve(user);\n            });\n        },\n        error: function () {\n          dfd.reject();\n        }\n      });\n      return dfd.promise;\n    }\n\n    function saveUser(params) {\n      $window.localStorage['currentUser'] = JSON.stringify(params);\n    }\n\n    function currentUser() {\n      return JSON.parse($window.localStorage['currentUser']);\n    }\n\n    function pushbitLogin(loginParams) {\n      var deferred = $q.defer();\n      $http.post(loc.apiBase + '/session', loginParams).\n        then(function (response) {\n          updateHeaders(response.data);\n          saveUser(response.data);\n          deferred.resolve(response.data);\n          $rootScope.$broadcast('event:auth-loginConfirmed');\n        });\n      return deferred.promise;\n    }\n\n    function updateHeaders(params) {\n      $http.defaults.headers.common['AuthToken-X'] = params.session_token;\n    }\n\n    function fbLogout() {\n      var dfd = $q.defer();\n      openFB.logout(function () {\n        $rootScope.$broadcast('event:auth-loginRequired');\n        dfd.resolve();\n      });\n      return dfd.promise;\n    }\n\n    return {\n      login: function () {\n        return fbLogin();\n      },\n      logout: function () {\n        return fbLogout();\n      },\n      currentUser: currentUser\n    };\n  });\n\n","/*global angular */\n\nangular.module('push.controllers')\n  .controller('LoginCtrl', function($scope, $state, User) {\n    $scope.message = '';\n    $scope.login = function () {\n      User.login();\n    };\n\n    $scope.$on('event:auth-loginRequired', function(e, rejection) {\n      $scope.loginModal.show();\n    });\n\n    $scope.$on('event:auth-loginConfirmed', function() {\n      console.log('login confirmed');\n      $scope.loginModal.hide();\n    });\n\n    $scope.$on('event:auth-loginFailed', function (e, status) {\n      console.log('login failed');\n      $scope.message = \"Login Failed\";\n    });\n\n    $scope.$on('event:auth-logoutComplete', function() {\n      console.log('login complete');\n      $state.go('tab.dash', {}, { reload: true, inherit: false });\n    });\n  });\n","/*global angular */\n\nangular.module('push.controllers')\n  .controller('AccountCtrl', function($scope, User) {\n    $scope.logout = function () {\n      User.logout();\n    };\n\n    $scope.settings = {\n      enableFriends: true\n    };\n  });\n","/*global _, openFB, angular */\nangular.module('push.services')\n  .factory('Friend', function ($http, Model, loc) {\n    var Friend = Model({ path: '/friendships' });\n\n    Friend.inviteFriend = function (email) {\n      return $http.post(loc.apiBase + '/friend_requests', {\n        email: email\n      });\n    };\n\n    return Friend;\n  });\n","/*global _, openFB, angular */\nangular.module('push.services')\n  .factory('FriendRequest', function ($q, $http, $rootScope, Users, loc) {\n    return {\n      all: function () {\n        return $http.get(loc.apiBase + '/friend_requests');\n      }\n    };\n  });\n\n","/*global angular */\nangular.module('push.controllers')\n  .controller('FriendsCtrl', function($scope, $ionicModal, Friend, FriendRequest) {\n    $scope.friends = [];\n    // $scope.friend_requests = [];\n\n    Friend.all().then(function (friends) {\n      $scope.friends = friends;\n    }, function () {\n       console.log('something went wrong when getting friends');\n    });\n\n    // FriendRequest.all().then(function (friend_requests) {\n    //   $scope.friend_requests = friend_requests;\n    // }, function () {\n    //   console.log('something went wrong when showing friend requests');\n    // });\n    //\n    // $ionicModal.fromTemplateUrl('templates/friendships.html', function (modal) {\n    //   $scope.friendshipsModal = modal;\n    // }, {\n    //   scope: $scope,\n    //   animation: 'slide-in-up'\n    // });\n    //\n    // $scope.showFriendships = function () {\n    //   $scope.friendshipsModal.show();\n    // };\n    //\n    // $scope.done = function () {\n    //   $scope.friendshipsModal.hide();\n    // };\n  });\n","angular.module('push.controllers')\n  .controller('FriendshipsCtrl', function($scope, Friend) {\n    $scope.friendEmail = '';\n\n    $scope.inviteFriend = function(email) {\n      console.log('inviting', email);\n      Friend.inviteFriend(email).then(function (friends) {\n        $scope.friendEmail = '';\n        $scope.message = 'Sent!';\n      });\n    }\n  });\n","/*global _, openFB, angular */\nangular.module('push.services')\n  .factory('Workout', function ($http, $q, Model, loc) {\n    var Workout = Model({ path: '/workouts' });\n\n    Workout.prototype.parse = function (response) {\n      if(response.workout_sets) {\n        this.workout_sets = _.map(response.workout_sets, (s) => {\n          return new WorkoutSet(s);\n        });\n        delete response.workout_sets;\n      }\n      return response;\n    };\n\n    Workout.prototype.addSet = function (set) {\n      var dfd = $q.defer();\n      $http.post(this.url() + '/workout_sets', {\n        reps: set.reps\n      }).\n      then(function (response) {\n        dfd.resolve(response.data);\n      }, function (response) {\n        dfd.reject(response);\n      });\n      return dfd.promise;\n    };\n\n    Workout.prototype.complete = function () {\n      var dfd = $q.defer();\n      $http.put(url(this.id), {}).\n        then(function (response) {\n          dfd.resolve(response.data);\n        }, function (response) {\n          dfd.reject(response);\n        });\n      return dfd.promise;\n    };\n\n    Workout.prototype.totalReps = function () {\n      var reps = 0;\n      this.get('workout_sets').forEach(function (set) {\n        reps += set.reps;\n      });\n      return reps;\n    };\n\n    Workout.prototype.completedAt = function () {\n      if (!this.get('completed_date')) {\n        return 'Incomplete';\n      }\n      return this.get('completed_date');\n    };\n\n    Workout.create = function () {\n      var dfd = $q.defer();\n      $http.post(Workout.url(), {}).\n        then(function (response) {\n          dfd.resolve(new Workout(response.data));\n        }, function(response) {\n          dfd.reject(response);\n        });\n      return dfd.promise;\n    };\n\n    return Workout;\n  });\n","/*global _, openFB, angular */\nangular.module('push.services')\n  .factory('WorkoutSet', function (Model, Workout, loc) {\n    var WorkoutSet = Model({ path: '/workout_sets' });\n\n    WorkoutSet.prototype.url = function () {\n      if(!this.id) {\n        return Workout.url() + this.workout_id + '/workout_sets';\n      }\n      return loc.apiBase + '/workout_sets' + this.id;\n    };\n\n    return WorkoutSet;\n  });\n","/*global angular */\nangular.module('push.controllers')\n  .controller('WorkoutCtrl', function($scope, $state, Workout, WorkoutSet) {\n    $scope.workout = null;\n    $scope.sets = [];\n    $scope.reps = 0;\n\n    // consider using this as a show page and only create\n    // a workout if it's visiting for a start workout\n    Workout\n      .create()\n      .then(function (workout) {\n        console.log('workout created');\n        console.log(workout);\n        $scope.workout = workout;\n      }, function () {\n        console.log('uhoh workout not created', arguments);\n      });\n\n    $scope.push = function () {\n      $scope.reps++;\n    };\n\n    $scope.completeSet = function () {\n      var set = new WorkoutSet({\n        reps: $scope.reps,\n        workout_id: $scope.workout.get('id')\n      });\n\n      set.save().then((response) => {\n        $scope.sets.push(set);\n        $scope.workout.workout_sets.push(set);\n        $sope.reps = 0;\n      });\n    };\n\n    $scope.completeWorkout = function () {\n      if($scope.reps > 0) {\n        var set = new Set($scope.reps);\n        $scope.workout.addSet(set).then(function () {\n          $scope.sets.push($scope.reps);\n          $scope.reps = 0;\n        });\n      }\n      $scope.workout.complete().then(function () {\n        $scope.sets = [];\n        $scope.reps = 0;\n        $state.go('tab.dash', {}, { reload: true, inherit: false });\n      });\n    };\n  });\n\n","/*global angular */\n\nangular.module('push.controllers')\n  .controller('WorkoutsCtrl', function($scope, $state, $ionicModal, Workout) {\n    $scope.workouts = [];\n\n    function setupWorkouts () {\n      Workout.all().then(function (workouts) {\n        console.log('got all workouts');\n        console.log(workouts);\n        $scope.workouts = workouts;\n      });\n    }\n\n    setupWorkouts();\n\n    $scope.$on('event:auth-loginConfirmed', function() {\n      setupWorkouts();\n    });\n\n    $scope.startWorkout = function () {\n      $state.go('workout', {}, { reload: true, inherit: false });\n    };\n\n    $ionicModal.fromTemplateUrl('templates/login.html', function (modal) {\n      $scope.loginModal = modal;\n    }, {\n      scope: $scope,\n      animation: 'slide-in-up'\n    });\n\n    $scope.$on('$destroy', function () {\n      $scope.loginModal.remove();\n    });\n  });\n"],"sourceRoot":"/source/"}